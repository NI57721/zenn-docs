---
title: "俺のAZIKが火を噴くぜ！"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["skk", "azik", "vim", "skkeleton"]
published: false
published_at: "2023-07-15 00:00"
---
この記事は[Vim駅伝](https://vim-jp.org/ekiden/)の2023-09-15の記事です。

------
先日、[とあるslack](https://vim-jp.org/docs/chat.html)で IME について雑談をしていたところ、AZIK ユーザーは何かしら独自の工夫をすることを余儀なくされているはずなので、みんなのマッピングなどをいろいろと見てみたいという話になりました。
そこで、先ず隗より始めよということで私の SKK + AZIK の設定をご紹介したいと思います。

### みんなで広げて行こう AZIK の輪 🙆

:::message
私は普段、日本語入力の全てを Vim 上で行っているため、この記事での SKK の設定は Vim での SKK 実装である [skkeleton](https://github.com/vim-skk/skkeleton) で行っています。
cf. [Vim を IME として使いこなす](https://zenn.dev/vim_jp/articles/14ab6ea83f711a)
:::

## AZIK とは？
ローマ字入力の拡張の一です。
AZIK の入力方法はローマ字入力の拡張となっており、一度に AZIK の全てを覚えなくとも段階的に移行できる点が魅力です。

詳しくは、AZIK の考案者である木村 清氏のウェブサイトをご覧ください。
[AZIK総合解説書](https://hp.vector.co.jp/authors/VA002116/azik/azikinfo.htm)

## SKK とは？
日本語入力システムの一です。
MS-IME や ATOK とは異り、漢字に変換する区切りをユーザーが決める必要があるという特徴があります。
SKK については以下の記事に詳しくあります。
[かな漢字変換プログラム SKK の紹介 | Emacs JP](https://emacs-jp.github.io/tips/skk-intro)
[SKKとは (エスケイケイとは) [単語記事] - ニコニコ大百科](https://dic.nicovideo.jp/a/skk)

## 工夫が必要なポイント
さて、SKK + AZIK の設定で工夫が必要になってくる点として、次のものが挙げられるかと思います。
- カタカナモード、半角カタカナモード、全角英数字モードなどに移る為のキー
- SKK の sticky key[^sk]
- 「っんーぁぃぅぇぉゃゅょゎ」に割り当てるキー
- 辞書の削除用キー
- 「←」などの記号を割り当てるマッピング
- その他、独自マッピング

この記事では他に、skkeleton に特有の便利な機能についてもご紹介します。

以降、[上述の木村氏のサイト](https://hp.vector.co.jp/authors/VA002116/azik/azikinfo.htm)の設定のことを「原典」、ないしは「原典の設定」と呼ぶこととします。
原典の設定を施している前提でそこからの差異について論じます。
また、私は普段 US 配列のキーボードを使用しています。ここでご紹介するマッピングも US 配列が前提となっています。


### カタカナモード、半角カタカナモード、全角英数字モードなど
SKK の実装には入力が直接カタカナになるモードなどがある場合が多く、これらのモードを遷移するマッピングは原典の設定と干渉しがちです。

- カタカナモード(`q`)
使用頻度は低めで`q`にマッピングしています。原典で`q`は「ん」に割り当てられていますが、あまり使用する頻度は高くないので問題無いと判断しました。

- 半角カタカナモード(`Q`)
更にあまり使わないモードです。マッピング理由は同上。

- 全角英数モード(`@`)
こちらもあまり使わないモードです。ホームから遠く、日本語を入力中に使う機会の少ない`@`を採用しました。

- abbr モード(`/`)
とてもよく使います。`/`で割り当てられている実装が多いのではないのでしょうか。

- SKK をオフ(`'`)
`l`に割り当てられることも多いと思いますが、`l`は「っ」に割り当てている為、その隣にあり、かつ、日本語入力中にあまり使わない`'`を採用しました。

- SKK のオン/オフをトグル(`C-J`[^ctrl])
上記`'`よりもこちらを使うことの方が多いです。

- インサート・モード/コマンドライン・モードから離脱(`jj`)
これは Vim での実装である skkeleton 独特の機能ですね。元々 Vim でのインサート・モードも`jj`で抜けるように設定しているので、日本語入力中であっても`jj`で離脱できるようにしています。また、同時に`JJ`で「じゅん」と入力するように設定しています。これは、原典では`jj`に「じゅん」が割り当てられている為です。

### sticky key(`;`)
`;`に割り当てられることが多いと思います。私もそうしています。`;`は原典では「っ」に割り当てられています。「っ」の退避先については次項で説明しましょう。

### 「っんーぁぃぅぇぉゃゅょゎ」
- っ(`l`/`L`)
「っ」は`l`にマッピングしています。また、変換を開始する「っ」には`L`を割り当てています。
:::message
#### 変換を開始する「っ」とは
いくつかの SKK 実装では`Omo:`を受け取った時点で、後ろにタ行が来るものと想定して変換を開始してしまう機能があります。
下記サイトでの調査によると、日本語で「っ」から始まる送り仮名は9割以上はその後にタ行が続くと見て問題ないだろうとのことです。

[日本語の「っ」から始まる送り仮名とSKK+AZIKによる日本語入力に関する考察 | Atusy's blog](https://blog.atusy.net/2023/08/01/skk-azik-and-sokuon-okuri/)
:::

- ん(`n`/`nn`/`n'`)
原典では`q`に割り当てられていますが、AZIK の拡張を使いこなしていればあまり使用する頻度は高くないでしょう。`n`が登録してあるのは、語末の`n`で「ん」になって欲しい為です。

- ー(`-`/`:`)
原典と同様です。加えて、「：」は`z:`で入力できるようにしています。

- ぁぃぅぇぉゃゅょゎ(`xx + X`[^small])
原典では`l + X`[^small]となっています。`l`は「っ」に使用していること、そして、そもそもこれらの文字を単独で入力することはあまりないという状況に鑑みて、多少手間ではありますがこのようなマッピングとしました。

### 辞書の削除用キー(`<`)
`X`に割り当てられている実装が多いのですが、私は`<`にしています。このキーが`X`のままだと、AZIK の場合は前の単語の変換を確定せずに`X`から始まる入力をしようとすると、前の単語を辞書から削除する操作になってしまいます。

### 「←」などの記号
例えば、デフォルトで「←↓→↑」をそれぞれ`zh`、`zj`、`zk`、`zl`に割り当てている実装も多いのではないのでしょうか。私は矢印は abbrev モードでそれぞれ`<`、`v`、`^`、`>`などで入力してます。abbrev モードの活用については後述。
私も`z`を prefix として利用しています。以下、よく使っているマッピングです。
- ・(`z/`)
- \<全角スペース\>(`z `)
- ～(`z~`/`z-`)
- …(`z.`)
- ：(`z:`)
- 『/』(`z[`/`z]`)   ※「/」は`[`/`]`

### 独自マッピング
- `f`に`q`相当の母音を割り当てる
原典では子音の後の`f`は空いてますから自由にマッピングできます。原典では`sf`だけ「さい」になっていますが、これを他の全ての子音にも対応させています。`f`は折角入力しやすい位置にあるのに勿体ないですからね。

- `sm`を「さま」に
ビジネス文書を書く際によく使うので気に入っています。

- `xi`/`xk`を「し/しん」に
私は元々ヘボン式ローマ字入力を律儀に守っていた質ですので、AZIK といえど`si`で「し」と入力するのには心理的な抵抗がありました。`j`や`c`などについても同様です。

- `dx`を「でした」、`mx`を「ました」
原典では`ds`で「です」、`ms`で「ます」があります。その派生で頻出の語尾を登録しました。
ここまでのマッピングを使うと、「ありがとうございました」などが大分省エネになりますね！

$$
  \begin{align*}
    \text{ローマ字入力}: \qquad &\text{arigatougozaimasita} \quad &\text{19キー} \\
    \text{AZIK}: \qquad &\text{arigatpgozfmx} \quad &\text{13キー}
  \end{align*}
$$

## `YL`で「読ん」、`KP`で「乞う」って変換できたら嬉しくない？
AZIKer なら一度は思ったことがあるのではないでしょうか。撥音拡張や二重母音拡張のキーを大文字で入力することで`L`と`oN`が等価になるように変換してみたいと。
大文字が連続していて、シフト・キーを押しっぱなしで良いのも楽で、打っていてすごく気持ち良いんですよねえ！
このような SKK の機能の実装を私は今まで聞いたことがないのですが、skkeleton に機能を追加して実装できるようにしてみました。

ここからは Vim のお話です！
以下は私の`vimrc`からの引用です。`s:azikOkuriList`を見ると雰囲気が分かってもらえるかと思います。
`imap`と`cmap`の両方で`Q`などをある関数を実行するようにマッピングしています。
その関数では、`aI`などキー列を SKK で入力したものとして送信しています。
そのままにしておくと、英語を入力する際にも`Q`が「あ▽い」などになってしまう為、SKK を無効したタイミングでマッピングを消し、再度 SKK が有効になったタイミングでもう一度同じマッピングを設定しています。
```vim
augroup Skkeleton
  autocmd!
  let s:azikOkuriList = [
    \   ['Q', 'aI'],
    \   ['Z', 'aNn'],
    \   ['K', 'iNn'],
    \   ['H', 'uU'],
    \   ['J', 'uNn'],
    \   ['W', 'eI'],
    \   ['D', 'eNn'],
    \   ['P', 'oU'],
    \   ['L', 'oNn'],
    \ ]

  function s:mapAzikOkuri(input, feed) abort
    for mode in ['i', 'c']
      exec 'autocmd User skkeleton-enable-post ' .. mode .. 'map <buffer> ' ..
        \   a:input .. " <Cmd>call <SID>azikOkuri('" .. a:input .. "', '" ..
        \   a:feed .. "')<CR>"
      exec 'autocmd User skkeleton-disable-post silent! ' .. mode ..
        \   'unmap <buffer> ' .. a:input
    endfor
  endfunction

  function s:azikOkuri(input, feed) abort
    if g:skkeleton#state.phase ==# 'input:okurinasi' && g:skkeleton#mode !=# 'abbrev'
      \   && g:skkeleton#vim_status().prevInput =~# '\a$'
      call skkeleton#handle('handleKey', {'key': split(a:feed, '\zs')})
    else
      call skkeleton#handle('handleKey', {'key': a:input})
    endif
  endfunction

  for item in s:azikOkuriList
    call s:mapAzikOkuri(item[0], item[1])
  endfor
augroup END
```

## 終わり
以上です。
AZIK 最高！

### みんなで広げて行こう AZIK の輪 🙆

------
[^sk]: SKK では大文字で入力することで変換の区切りを表現します。例えば、「思う」と変換したい場合は「OmoU」と入力します。この大文字での表現を特定のキーで代替するのが sticky key です。sticky key を「;」に設定していた場合、「思う」は「;omo;u」とも入力できます。

[^ctrl]: `C-X` でコントロール・キーと X を押すことを表すこととします。ここで X は大文字ですがシフト・キーも同時に押すという意味ではありません。

[^small]: ここで`xx + X`は、`a`の後に対応するローマ字入力をしていることを表すものとします。つまり、「ぁ」は`xxa`、「ゃ」は`xxya`、そして「ゎ」は`xxwa`となります。直後の`l + X`についても同様とします。

